---
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import { getLangFromUrl, getUrlWithoutLang, useTranslations, useTranslatedPath } from "@i18n/utils";

const isDev = import.meta.env.DEV;

const lang = getLangFromUrl(Astro.url);
const path = getUrlWithoutLang(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

let pages = [
	{
		title: "Home",
		url: "/",
	},
	// {
	// 	title: "Services",
	// 	url: "/services",
	// },
	{
		title: "Blog",
		url: "/blog/",
	},
	{
		title: t("contacts"),
		url: "/contact/",
	},
];

// if (isDev) {
// 	pages.push({
// 		title: "Overview",
// 		url: "/system/overview",
// 	});
// }

const { pathname } = Astro.url;
---

<header>
	<a href={translatePath("/")} aria-label="Home" class="logo absolute z-50 flex h-[4.5rem] items-center md:h-[5.9rem]">
		<svg
			version="1.1"
			xmlns="http://www.w3.org/2000/svg"
			xmlns:xlink="http://www.w3.org/1999/xlink"
			viewBox="0 0 3734.58 545.3"
			xml:space="preserve"
			class="logo-svg h-10 w-50 md:h-9"
			fill="transparent"
			stroke="currentColor"
			stroke-alignment="inner"
			stroke-width="10"
			>
	<g data-astro-cid-ieyx6y3k="">
    <g>
      <path class="st0" d="M1893.77,420.95c-5.93,0-8.9-2.4-8.9-7.21,0-1.69.41-3.52,1.28-5.5l98.73-272.48c3.1-7.62,8.74-11.43,16.95-11.43h110.18c8.47,0,14.12,3.81,16.95,11.43l98.73,272.48c.84,1.98,1.28,3.81,1.28,5.5,0,4.81-2.97,7.21-8.9,7.21h-94.07c-6.5,0-10.88-3.24-13.14-9.74l-9.74-29.67c-1.43-4.22-3.97-6.35-7.64-6.35h-77.13c-3.67,0-6.21,2.12-7.62,6.35l-9.74,29.67c-2.28,6.5-6.64,9.74-13.14,9.74h-94.07ZM2071.74,295.94c1.69,0,2.97-.48,3.81-1.48.84-.98,1.12-2.33.84-4.02l-16.52-58.9c-.57-1.41-1.55-2.12-2.97-2.12s-2.41.71-2.97,2.12l-16.54,58.9v1.26c0,1.14.43,2.12,1.28,2.97.84.86,1.97,1.28,3.4,1.28h29.66Z"/>
      <path class="st0" d="M2217.24,306.12c-5.66,0-8.47-2.83-8.47-8.48v-50c0-5.64,2.81-8.47,8.47-8.47h129.25c5.64,0,8.47,2.83,8.47,8.47v50c0,5.66-2.83,8.48-8.47,8.48h-129.25Z"/>
      <path class="st2" d="M3390.23,420.95c-2.55,0-4.6-.78-6.16-2.33-1.55-1.55-2.33-3.6-2.33-6.16V132.8c0-2.81.78-4.93,2.33-6.35,1.55-1.41,3.6-2.12,6.16-2.12h237.72c5.64,0,8.47,2.83,8.47,8.47v65.26c0,2.53-.71,4.6-2.12,6.14-1.41,1.57-3.53,2.34-6.35,2.34h-135.18c-2.83,0-4.24,1.41-4.24,4.22v21.62c0,2.83,1.41,4.22,4.24,4.22h121.2c5.64,0,8.47,2.83,8.47,8.48v50c0,2.53-.71,4.59-2.12,6.14-1.41,1.57-3.53,2.33-6.35,2.33h-121.2c-2.83,0-4.24,1.43-4.24,4.24v23.31c0,2.83,1.41,4.24,4.24,4.24h135.18c5.64,0,8.47,2.83,8.47,8.47v68.64c0,2.55-.71,4.6-2.12,6.16-1.41,1.55-3.53,2.33-6.35,2.33h-237.72Z"/>
      <path class="st0" d="M2743.96,138.9v-6.1c0-2.53-.78-4.59-2.33-6.14-1.55-1.55-3.6-2.33-6.14-2.33h-114.42c-2.53,0-4.38.64-5.5,1.9-1.14,1.28-2.41,3.47-3.83,6.57l-48.73,113.99c-.28,1.71-1.41,2.55-3.38,2.55-1.43,0-2.55-.84-3.4-2.55l-50.43-113.99c-1.41-3.1-2.67-5.29-3.81-6.57-1.12-1.26-2.97-1.9-5.5-1.9h-112.71c-2.55,0-4.6.78-6.16,2.33-1.55,1.55-2.33,3.6-2.33,6.14v279.67c0,2.55.78,4.6,2.33,6.16,1.55,1.55,3.6,2.33,6.16,2.33h90.68c2.53,0,4.59-.78,6.14-2.33,1.55-1.55,2.33-3.6,2.33-6.16v-124.99c0-1.98,1-2.97,2.97-2.97s3.1.84,3.4,2.53l30.5,84.33c1.14,3.1,2.4,5.36,3.83,6.78,1.4,1.41,3.52,2.12,6.35,2.12h59.33c2.83,0,4.93-.71,6.36-2.12,1.4-1.41,2.67-3.67,3.81-6.78l30.5-84.33c.57-1.69,1.71-2.53,3.4-2.53,1.97,0,2.97.98,2.97,2.97v124.99c0,2.55.78,4.6,2.33,6.16,1.55,1.55,3.6,2.33,6.14,2.33h90.7c2.53,0,4.59-.78,6.14-2.33,1.55-1.55,2.33-3.6,2.33-6.16v-99.29c-3.46-4.53-7-9.06-9.92-13.53-39.12-59.84-25.56-121.85,9.92-160.74Z"/>
      <path class="st2" d="M3362.9,412.05l-44.07-104.66-.84-3.4c0-2.26.84-4.24,2.53-5.93,10.17-10.45,17.79-21.6,22.88-33.48,5.09-11.86,7.64-25.55,7.64-41.09,0-31.09-10.1-55.37-30.29-72.88-20.21-17.52-49.24-26.28-87.09-26.28h-159.32c-2.55,0-4.6.78-6.16,2.33-1.55,1.55-2.33,3.6-2.33,6.14v6.23c35.56,38.94,49.09,101.07,9.79,160.85-2.87,4.37-6.38,8.85-9.79,13.3v99.29c0,2.55.78,4.6,2.33,6.16s3.6,2.33,6.16,2.33h93.21c2.55,0,4.59-.78,6.16-2.33,1.53-1.55,2.33-3.6,2.33-6.16v-77.97c0-2.81,1.41-4.22,4.24-4.22h29.66c3.67,0,5.93,1.41,6.78,4.22l32.62,78.83c1.98,5.09,5.52,7.62,10.6,7.62h97.04c4.52,0,6.78-1.83,6.78-5.5l-.84-3.4ZM3240.86,227.72c0,6.22-1.84,11.02-5.52,14.41-3.67,3.4-8.62,5.09-14.83,5.09h-40.24c-2.83,0-4.24-1.41-4.24-4.24v-33.05c0-2.81,1.41-4.24,4.24-4.24h40.24c6.21,0,11.16,1.71,14.83,5.09,3.67,3.4,5.52,8.21,5.52,14.41v2.53Z"/>
      <path class="st1" style="color: #ec145a;" d="M3070.7,205.16c-1.13-5.75-2.76-11.33-4.85-16.69-.27-.69-.38-1.45-.66-2.13-7.16-17.25-18.93-32.04-33.31-42.7-4.08-3.02-8.43-5.72-12.97-8.1-1.48-.78-3.1-1.31-4.63-2.01-3.15-1.45-6.29-2.92-9.6-4.03-1.92-.64-3.96-.99-5.93-1.52-3.06-.81-6.11-1.68-9.28-2.19-2.19-.34-4.45-.38-6.67-.57-3.04-.26-6.07-.57-9.17-.52-3.22.05-6.5.54-9.77.95-2.46.3-4.9.42-7.37.93-3.46.72-6.93,1.97-10.4,3.11-2.32.77-4.64,1.27-6.96,2.24-3.87,1.61-7.7,3.86-11.53,6.06-1.9,1.09-3.82,1.85-5.71,3.09-5.7,3.73-11.32,8.1-16.82,13.26-5.51-5.19-11.15-9.58-16.86-13.33-1.94-1.27-3.91-2.08-5.87-3.19-3.79-2.17-7.58-4.41-11.4-6.01-2.37-.99-4.74-1.53-7.11-2.32-3.43-1.13-6.87-2.37-10.29-3.09-2.5-.52-4.97-.66-7.46-.97-3.26-.41-6.53-.89-9.75-.95-3.08-.05-6.1.23-9.13.49-2.23.19-4.49.22-6.67.57-3.16.5-6.21,1.35-9.27,2.16-1.97.52-3.99.87-5.91,1.51-3.33,1.11-6.5,2.58-9.66,4.03-1.5.69-3.1,1.21-4.56,1.97-4.55,2.37-8.9,5.06-12.99,8.08-9.61,7.09-18.07,16.02-24.77,26.3-3.81,5.84-6.86,12.21-9.43,18.83-1.95,5.03-3.71,10.17-4.84,15.56-2.61,12.48-2.89,25.82-.24,39.51,1.08,5.57,2.99,11.22,5.08,16.87h0c3.04,8.25,6.85,16.53,12.25,24.79,11.61,17.74,28.58,36.48,46.82,54.21,30.4,29.55,64.31,56.27,82.75,70.8,3.88,3.07,6.93,5.46,8.88,7.06,3.02,2.47,6.69,3.72,10.38,3.72s7.31-1.23,10.32-3.67l7.9-6.26c13.54-10.68,38.3-30.19,63.57-52.99,12.63-11.4,25.4-23.62,36.95-35.96,11.55-12.34,21.9-24.81,29.7-36.71,4.56-6.94,8.24-13.91,11.12-20.86.56-1.37.73-2.71,1.24-4.07h0c4.72-12.77,6.81-25.41,6.67-37.53-.07-6.06-.69-11.99-1.82-17.74Z"/>
      <path class="st0" d="M206.23,427.74c-25.42,0-47.95-4.38-67.59-13.14-19.64-8.74-35.11-20.83-46.4-36.23-11.29-15.4-17.66-32.85-19.07-52.33v-1.28c0-5.93,2.69-8.9,8.05-8.9h88.57c5.36,0,8.47,2.83,9.31,8.48,2.55,15.81,13.57,23.73,33.05,23.73,20.62,0,30.93-6.78,30.93-20.35,0-5.36-3.03-9.6-9.1-12.71-6.07-3.1-16.47-5.79-31.14-8.05l-39.83-6.36c-58.76-9.31-88.14-38.69-88.14-88.13,0-19.78,5.72-36.8,17.16-51.07,11.45-14.26,27.05-25.14,46.83-32.62,19.76-7.48,41.95-11.22,66.52-11.22h11.45c26.83,0,49.64,4.59,68.44,13.76,18.78,9.19,32.83,20.92,42.16,35.17,9.33,14.28,13.98,28.9,13.98,43.86,0,5.66-2.53,8.47-7.62,8.47h-81.78c-2.55,0-4.88-.69-7-2.12-2.12-1.4-3.6-3.52-4.45-6.35-1.69-4.81-5.16-8.76-10.38-11.86-5.24-3.1-11.79-4.67-19.71-4.67-9.9,0-17.31,1.48-22.24,4.45-4.95,2.97-7.41,6.86-7.41,11.66,0,4.52,2.53,8.21,7.62,11.02,5.09,2.83,13.98,5.09,26.69,6.78l45.78,6.79c29.09,4.22,51.33,13.41,66.73,27.54,15.4,14.12,23.1,34.74,23.1,61.87,0,20.92-5.66,39.19-16.95,54.88-11.31,15.67-26.98,27.74-47.04,36.23-20.07,8.47-42.95,12.71-68.66,12.71h-11.86Z"/>
      <path class="st0" d="M462.65,420.96c-2.55,0-4.6-.78-6.16-2.33-1.55-1.55-2.33-3.6-2.33-6.16v-199.99c0-2.83-1.41-4.24-4.24-4.24h-81.78c-2.53,0-4.59-.78-6.14-2.33-1.55-1.55-2.33-3.6-2.33-6.16v-66.95c0-2.53.78-4.59,2.33-6.14,1.55-1.55,3.6-2.33,6.14-2.33h282.22c2.53,0,4.59.78,6.14,2.33s2.33,3.6,2.33,6.14v66.95c0,2.55-.78,4.6-2.33,6.16s-3.6,2.33-6.14,2.33h-81.78c-2.83,0-4.24,1.41-4.24,4.24v199.99c0,2.55-.78,4.6-2.33,6.16s-3.6,2.33-6.16,2.33h-93.21Z"/>
      <path class="st0" d="M833.79,427.74c-46.33,0-82.14-12.35-107.42-37.07-25.29-24.73-37.93-59.81-37.93-105.3v-152.56c0-2.53.78-4.59,2.34-6.14,1.53-1.55,3.59-2.33,6.14-2.33h93.23c2.53,0,4.59.78,6.14,2.33,1.55,1.55,2.33,3.6,2.33,6.14v157.22c0,16.38,3.74,29.17,11.22,38.35,7.48,9.19,18.16,13.78,32,13.78s24.5-4.59,31.98-13.78c7.48-9.17,11.24-21.97,11.24-38.35v-157.22c0-2.53.78-4.59,2.33-6.14s3.6-2.33,6.14-2.33h93.23c2.53,0,4.59.78,6.14,2.33,1.55,1.55,2.33,3.6,2.33,6.14v152.56c0,45.49-12.64,80.57-37.92,105.3-25.29,24.73-61.09,37.07-107.42,37.07h-16.1Z"/>
      <path class="st0" d="M1033.31,420.96c-2.55,0-4.6-.78-6.16-2.33-1.55-1.55-2.33-3.6-2.33-6.16V132.81c0-2.53.78-4.59,2.33-6.14,1.55-1.55,3.6-2.33,6.16-2.33h136.44c47.74,0,85.11,12.5,112.08,37.5,26.98,25,40.47,60.38,40.47,106.14v9.33c0,45.76-13.48,81.14-40.47,106.14-26.97,25-64.33,37.5-112.08,37.5h-136.44ZM1163.82,333.66c14.69,0,26.12-4.36,34.33-13.14,8.19-8.74,12.28-20.47,12.28-35.16v-25.43c0-14.69-4.09-26.42-12.28-35.17-8.21-8.74-19.64-13.14-34.33-13.14h-24.57c-2.83,0-4.24,1.43-4.24,4.24v113.58c0,2.83,1.41,4.22,4.24,4.22h24.57Z"/>
      <path class="st0" d="M1360.38,420.96c-2.55,0-4.6-.78-6.16-2.33-1.55-1.55-2.33-3.6-2.33-6.16V132.81c0-2.81.78-4.93,2.33-6.35,1.55-1.41,3.6-2.12,6.16-2.12h93.21c5.66,0,8.48,2.83,8.48,8.47v279.67c0,2.55-.71,4.6-2.12,6.16-1.41,1.55-3.53,2.33-6.36,2.33h-93.21Z"/>
      <path class="st0" d="M1644.65,427.74c-29.38,0-55.66-6.07-78.82-18.23-23.16-12.14-41.31-29.59-54.45-52.33-13.14-22.73-19.71-49.36-19.71-79.87v-9.33c0-30.5,6.57-57.12,19.71-79.88,13.14-22.73,31.29-40.17,54.45-52.33,23.16-12.14,49.59-18.21,79.25-18.21h15.26c29.66,0,56.07,6.07,79.23,18.21,23.17,12.16,41.33,29.61,54.45,52.33,13.14,22.76,19.71,49.38,19.71,79.88v9.33c0,30.5-6.57,57.14-19.71,79.87-13.12,22.74-31.28,40.19-54.45,52.33-23.16,12.16-49.43,18.23-78.82,18.23h-16.1ZM1688.95,326.68c8.6-10.31,12.91-25.92,12.91-46.83v-14.4c0-20.92-4.31-36.52-12.91-46.83-8.62-10.31-20.71-15.47-36.24-15.47s-27.61,5.16-36.23,15.47c-8.62,10.31-12.93,25.92-12.93,46.83v14.4c0,20.92,4.31,36.52,12.93,46.83s20.69,15.47,36.23,15.47,27.62-5.16,36.24-15.47Z"/>
    </g>
  </g>
		</svg>
	</a>
	<div data-xdata="{ open: false }" class="navigation fixed right-0 top-0 z-50" data-xbind.class="{'w-full navbar-open': open}">
		<div class="ml-auto md:max-w-fit" data-xbind.class="{'max-w-3xl': open, 'max-w-[8rem]': !open }">
			<div class="mx-auto w-full">
				<div
					class="shadow-thick resizable nav-container squircle relative mx-auto flex w-full flex-col justify-center overflow-x-hidden bg-zinc-900 backdrop-blur-xl backdrop-filter md:flex-row-reverse">
					<div class="flex flex-row items-center justify-end md:hidden">
						<a class="px-3 py-[0.4rem] pl-4" href={translatePath("/contact/")} aria-label="Contact Page">
							<Icon class="text-white" name="octicon:mail-16" width="20" data-xbind.class="{'hidden': open}" />
						</a>
						<button
							data-xon.click="open = !open"
							data-xbind.style="{'padding-top': open ? '1rem' : '0.4rem'}"
							aria-label="Open navbar"
							class="inline-flex items-center justify-center px-3 py-[0.4rem] pr-4 text-white hover:text-blue-300 focus:text-white focus:outline-none">
							<svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
								<path
									data-xbind.class="{'hidden': open, 'inline-flex': !open }"
									class="inline-flex"
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M4 6h16M4 12h16M4 18h16">
								</path>
								<path
									data-xbind.class="{'hidden': !open, 'inline-flex': open }"
									class="hidden"
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M6 18L18 6M6 6l12 12">
								</path>
							</svg>
						</button>
					</div>
					<nav data-xbind.class="{'flex': open, 'hidden': !open}" class="hidden flex-grow flex-col justify-center py-12 md:flex md:py-0">
						<ul
							class="flex list-none flex-col items-end justify-center gap-2 px-2 text-center text-3xl md:flex-row md:items-center md:text-base">
							{
								pages.map((page) => (
									<li data-cursor-hover>
										<a
											href={translatePath(page.url)}
											class={`inline-block cursor-pointer px-1 py-[0.33rem] ${
												page.url === pathname ||
												page.url === pathname.replace(/^\/it|\/$/, "") ||
												(page.url === "/blog" && (pathname.startsWith("/blog") || pathname.startsWith("/it/blog")))
													? "active"
													: ""
											}`}>
											<span class="menu-item-container inline-block">
												<span class="menu-item px-4 py-1 font-semibold uppercase tracking-wide text-zinc-400 hover:text-white focus:text-white focus:shadow-none focus:outline-none">
													{page.title}
												</span>
											</span>
										</a>
									</li>
								))
							}
							<li>
								<a href={translatePath(path, `${lang === "it" ? "en" : "it"}`)} class="inline-block cursor-pointer px-1 py-[0.33rem]">
									<span class="menu-item-container inline-block">
										<span
											class="menu-item px-4 py-1 font-semibold uppercase tracking-wide text-zinc-400 hover:text-white focus:text-white focus:shadow-none focus:outline-none">
											{lang === "it" ? "en" : "it"}
										</span>
									</span>
								</a>
							</li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</div>
</header>

<style>
	.navigation {
		mix-blend-mode: difference;
	}
	.navigation.navbar-open {
		mix-blend-mode: luminosity;
	}
	.navigation,
	.logo {
		padding: 1rem var(--base-padding-x);
	}
	@media (min-width: 768px) {
		.navigation,
		.logo {
			padding: 2rem var(--base-padding-x);
		}
	}
	.resizable:before {
		content: "|";
		position: absolute;
		left: 0.4rem;
		top: 0.36rem;
		font-size: 12px;
		line-height: 23px;
		color: #8e8e8e;
		opacity: 0;
		text-shadow: 4px 0 #8e8e8e;
		transition: all 0.5s ease;
	}
	.collapsed .resizable:before {
		opacity: 1;
	}
	nav a .menu-item-container {
		border-radius: 0.45rem;
	}
	nav a.active .menu-item-container,
	nav a:hover .menu-item-container {
		transition: background-color 0.3s ease;
	}
	nav ul:not(.collapsed) a.active .menu-item-container {
		transition-duration: 0.5s;
		background: #aaa;
	}
	nav ul:not(.collapsed) a:hover .menu-item-container {
		background: #fff;
	}
	nav ul:not(.collapsed) a.active .menu-item-container .menu-item,
	nav ul:not(.collapsed) a:hover .menu-item-container .menu-item {
		color: #000;
	}
	nav ul.collapsed a.active .menu-item-container .menu-item,
	nav ul.collapsed a:hover .menu-item-container .menu-item {
		color: #fff;
	}
</style>

<script>
	import { gsap } from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";
	import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";

	gsap.registerPlugin(DrawSVGPlugin, ScrollTrigger);

	function init() {
		gsap.timeline({
			defaults: {
				duration: 1,
				ease: "power2.out",
			},
		})
			.from(".logo-svg path", { drawSVG: 0, fill: "transparent" })
.to(".logo-svg path", { 
    fill: (index, target) => {
        return target.classList.contains("st1") ? "#ec145a" : "#000";
    },
    stroke: "transparent", 
    duration: 2 
}, "<+=0.5");

		let isHoveringMenu = false;
		let menuCollapsed = false;

		const pageLinksUl = document.querySelector("header .nav-container nav ul");

		if (!pageLinksUl) {
			return;
		}

		let menuCollapseTl = gsap
			.timeline({
				defaults: {
					ease: "back.inOut(1.7)",
					duration: 0.4,
				},
				paused: true,
				onStart: () => {
					pageLinksUl.classList.add("collapsed");
				},
			})
			.to("header .nav-container", { width: 125 })
			.to(
				pageLinksUl,
				{
					x: () => {
						const pathName = window.location.pathname;

						if (pathName === "/" || pathName === "/it/") {
							return "9.5rem";
						} else if (pathName.startsWith("/blog") || pathName.startsWith("/it/blog")) {
							return "3.5rem";
						}

						return "-3.5rem";
					},
				},
				"<",
			);

		const isTouchDevice = window.matchMedia("(hover: none)").matches;

		if (window.innerWidth >= 768 && !isTouchDevice) {
			function expandMenu() {
				menuCollapseTl.reverse();
				pageLinksUl?.classList.remove("collapsed");
				document.querySelector("header .navigation")?.classList.remove("collapsed");
				menuCollapsed = false;
			}

			function collapseMenu() {
				if (window.scrollY > 200) {
					menuCollapseTl.play();
					pageLinksUl?.classList.add("collapsed");
					document.querySelector("header .navigation")?.classList.add("collapsed");
					menuCollapsed = true;
				}
			}

			collapseMenu();

			const navContainer = document.querySelector(".nav-container") as HTMLElement;

			function mouseEnterHandler() {
				isHoveringMenu = true;
				expandMenu();
			}

			function mouseLeaveHandler() {
				isHoveringMenu = false;
				collapseMenu();
			}

			function handleScroll() {
				if (window.scrollY > 200 && !isHoveringMenu && !menuCollapsed) {
					collapseMenu();
				} else if (window.scrollY <= 200 && menuCollapsed) {
					expandMenu();
				}
			}

			navContainer?.removeEventListener("mouseenter", mouseEnterHandler);
			navContainer?.addEventListener("mouseenter", mouseEnterHandler);

			navContainer?.removeEventListener("mouseleave", mouseLeaveHandler);
			navContainer?.addEventListener("mouseleave", mouseLeaveHandler);

			window?.removeEventListener("scroll", handleScroll);
			window?.addEventListener("scroll", handleScroll);
		}
	}

	document.removeEventListener("DOMContentLoaded", init); // astro:page-load
	document.addEventListener("DOMContentLoaded", init); // astro:page-load
</script>
